# NOTE:
#
# This config file is generated from a source script and should not be modified
# manually. If you want to make changes to this config that are remembered
# between upgrades, ensure that you update `script/generate-travis-config.js`,
# run `npm run generate-travis-config` to generate a new config, and commit the
# change to the repository.
#
sudo: required
services:
  - docker
env:
  global:
    - GIT_LFS_VERSION=2.6.0
matrix:
  include:
    - os: linux
      language: c
      env:
        - TARGET_PLATFORM=ubuntu
        - GIT_LFS_CHECKSUM=43e9311bdded82d43c574b075aafaf56681a3450c1ccf59cce9d362acabf1362
    - os: osx
      language: c
      env:
        - TARGET_PLATFORM=macOS
        - GIT_LFS_CHECKSUM=42bf89b9775a69ab7dbe65847e174fe802d54ce6ed0d553bd497c740f2803f60
    - os: linux
      language: c
      env:
        - TARGET_PLATFORM=win32
        - WIN_ARCH=64
        - GIT_FOR_WINDOWS_URL=https://github.com/git-for-windows/git/releases/download/v2.19.2.windows.1/MinGit-2.19.2-64-bit.zip
        - GIT_FOR_WINDOWS_CHECKSUM=9d260fd4b9cf279491a1cc6762c2f08f7e8ca6c1d6492300cacbc800fe384a0f
        - GIT_LFS_CHECKSUM=f1312d00e435c16c8d19d914d5108db6a5ddbee1badb214c66f22cfa5d18b279
    - os: linux
      language: c
      env:
        - TARGET_PLATFORM=win32
        - WIN_ARCH=32
        - GIT_FOR_WINDOWS_URL=https://github.com/git-for-windows/git/releases/download/v2.19.2.windows.1/MinGit-2.19.2-32-bit.zip
        - GIT_FOR_WINDOWS_CHECKSUM=a85f4343628e7591a60ced4d54df176dba1c599b9097d1dc86597fd00bc3a5b3
        - GIT_LFS_CHECKSUM=7fa3475c60221837860138b4fd0fd0ad1213a5e49c596fdb0aac8932ca7a20a5
    - os: linux
      language: c
      env:
        - TARGET_PLATFORM=arm64
        - GIT_LFS_CHECKSUM=574192d485ce84495fe3f228a57e3ef80f93635ae4677ac4a189425b4c9aeb0a
    - os: linux
      language: shell
      script:
        - bash -c 'shopt -s globstar; shellcheck script/**/*.sh'
    - os: linux
      language: node_js
      node_js:
        - node
      script:
        - npm run check && npm run prettier
compiler:
  - gcc
script:
  - script/build.sh && script/package.sh
branches:
  only:
    - master
    - /^v[0-9]*.[0-9]*.[0.9]*.*$/
deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file_glob: true
  file:
    - ${TRAVIS_BUILD_DIR}/output/dugite-native-v*.tar.gz
    - ${TRAVIS_BUILD_DIR}/output/dugite-native-v*.lzma
    - ${TRAVIS_BUILD_DIR}/output/dugite-native-v*.sha256
  skip_cleanup: true
  draft: true
  tag_name: $TRAVIS_TAG
  on:
    tags: true
